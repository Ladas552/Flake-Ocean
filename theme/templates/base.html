<!DOCTYPE html>
<html lang="{{ config.language }}">

<head>
  {% block head %}
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="generator" content="Norgolith" />

  {# Meta tags #}
  {% if metadata.description and not metadata.description == "nil" %}
  <meta name="description" content="{{ metadata.description }}" />
  {% endif %}
  {% if metadata.authors %}
  <meta name="author" content="{{ metadata.authors }}" />
  {% endif %}
  {% if metadata.categories and metadata.categories | length > 0 %}
  <meta name="keywords" content="{{ metadata.categories | join(sep=" , ") }}" />
  {% endif %}

  {% block seo_tags %}{% endblock seo_tags %}

  {# Syntax highlighter #}
  {% if config.highlighter is defined and config.highlighter.enable %}
  {% if config.highlighter.engine is not string or config.highlighter.engine == "prism" %}
  <link rel="stylesheet" href="/assets/css/prism-sweetie.min.css" />
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script defer
    src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <script defer
    src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
  {% elif config.highlighter.engine is defined and config.highlighter.engine == "hljs" %}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  {% endif %}
  {% endif %}

  {# AlpineJS #}
  <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script>
    document.addEventListener("alpine:init", () => {
      Alpine.data("menu", () => ({
        currentPage: window.location.pathname,
        openMobile: false,
        sidebarCollapsed: localStorage.getItem('sidebarCollapsed') === 'true',

        toggleMobile() {
          this.openMobile = !this.openMobile;
        },

        toggleSidebar() {
          this.sidebarCollapsed = !this.sidebarCollapsed;
          localStorage.setItem('sidebarCollapsed', this.sidebarCollapsed);
        }
      }));

      Alpine.data("theme", () => ({
        current: "light",
        init() {
          const storedTheme = localStorage.getItem("theme");
          if (storedTheme) {
            this.current = storedTheme;
          } else if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
            this.current = "dark";
          }
          localStorage.setItem("theme", this.current);
          if (this.current === "dark") {
            document.documentElement.classList.add("dark");
          }
        },
        toggle(event) {
          // Get button position for radial expansion
          const x = event.clientX;
          const y = event.clientY;

          // Set CSS custom properties for animation origin
          document.documentElement.style.setProperty('--x', `${x}px`);
          document.documentElement.style.setProperty('--y', `${y}px`);

          // Check if View Transitions API is supported
          if (!document.startViewTransition) {
            // Fallback for browsers without View Transitions API
            this.current = this.current === "dark" ? "light" : "dark";
            document.documentElement.classList.toggle("dark", this.current === "dark");
            localStorage.setItem("theme", this.current);
            return;
          }

          // Use View Transitions API for smooth radial expansion
          const transition = document.startViewTransition(() => {
            this.current = this.current === "dark" ? "light" : "dark";
            document.documentElement.classList.toggle("dark", this.current === "dark");
            localStorage.setItem("theme", this.current);
          });
        }
      }));
    });
  </script>

  {# MermaidJS #}
  {% if config.extra.enable_mermaid %}
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.9.0/mermaid.min.js"></script>
  {% endif %}

  {# Styling and favicon #}
  <link rel="stylesheet" href="/assets/css/styles.min.css" />
  {% if config.extra.favicon_path is defined and config.extra.favicon_path is string %}
  <link rel="icon" href={{ config.extra.favicon_path }} />
  {% else %}
  <link rel="icon" href="/assets/norgolith.svg" />
  {% endif %}

  <title>{% block title %}{% endblock title %} - {{ config.title | title }}</title>
  {% endblock head %}
</head>

<body x-data="menu">
  <header>
    {% include "partials/nav.html" %}
  </header>

  <div class="page-wrapper">
    <!-- Collapsible Sidebar - Only Posts -->
    <aside class="sidebar" :class="{ 'open': openMobile, 'collapsed': sidebarCollapsed }">
      <!-- Collapse Toggle (Desktop) -->
      <button @click="toggleSidebar" class="sidebar-toggle hidden md:flex"
        :aria-label="sidebarCollapsed ? 'Expand sidebar' : 'Collapse sidebar'">
        <svg x-show="!sidebarCollapsed" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
        </svg>
        <svg x-show="sidebarCollapsed" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
        </svg>
      </button>

      <nav>
        <!-- Documentation Posts Only -->
        {% if posts | length > 0 %}
        <div class="nav-section">
          <h3>Documentation</h3>
          {% for post in posts | sort(attribute="created") %}
          <a :class="{ 'active': currentPage === '{{ post.permalink }}' }" href="{{ post.permalink }}"
            title="{{ post.description }}">{{ post.title }}</a>
          {% endfor %}
        </div>
        {% else %}
        <div class="nav-section">
          <p style="padding: 0 12px; color: var(--text-muted); font-size: 0.9em;">No documentation posts yet.</p>
        </div>
        {% endif %}
      </nav>
    </aside>

    <!-- Main Content -->
    <div class="content-wrapper" :class="{ 'sidebar-collapsed': sidebarCollapsed }">
      <main class="content">
        {% block content %}{% endblock content %}
      </main>

      <footer>
        {% include "partials/footer.html" %}
      </footer>
    </div>
  </div>
</body>

</html>